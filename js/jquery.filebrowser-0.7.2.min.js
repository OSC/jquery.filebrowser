/**@license
 *
 * jQuery File Browser - directory browser jQuery plugin version 0.7.2
 *
 * Copyright (c) 2016 Jakub Jankiewicz <http://jcubic.pl>
 * Released under the MIT license
 *
 * Date: Sat, 02 Sep 2017 10:43:44 +0000
 */
(function(e,t){"use strict";function r(e,t,r){this.browser=e;this.upload=t;this.error=r}r.prototype.process=function t(r,n){var a=e.Deferred();var i=this;if(r.originalEvent){r=r.originalEvent}var s;if(r.dataTransfer.items){s=[].slice.call(r.dataTransfer.items)}var o=r.dataTransfer.files||r.target.files;if(o){o=[].slice.call(o)}if(s&&s.length){if(s[0].webkitGetAsEntry){var l=[];s.forEach(function(e){var t=e.webkitGetAsEntry();if(t){l.push(t)}});(function e(){var t=l.shift();if(t){i.upload_tree(t,n).then(e)}else{a.resolve()}})()}}else if(o&&o.length){(function e(){var t=o.shift();if(t){i.upload(t,n).then(e)}else{a.resolve()}})()}else if(r.dataTransfer.getFilesAndDirectories){r.dataTransfer.getFilesAndDirectories().then(function(e){(function t(){var r=e.shift();if(r){i.upload_tree(r,n).then(t)}else{a.resolve()}})()})}return a.promise()};r.prototype.upload_tree=function t(r,n){var a=e.Deferred();var i=this;function s(e,t){e=e.slice();(function r(){var n=e.shift();if(n){t(n).then(r).fail(function(){a.reject()})}else{a.resolve()}})()}function o(e){s(e,function(e){return i.upload_tree(e,i.browser.join(n,r.name))})}function l(e){i.upload(e,n).then(function(){a.resolve()}).fail(function(){a.reject()})}if(typeof Directory!="undefined"&&r instanceof Directory){r.getFilesAndDirectories().then(function(e){o(e)})}else if(typeof File!="undefined"&&r instanceof File){l(r)}else if(r.isFile){r.file(l)}else if(r.isDirectory){var f=r.createReader();f.readEntries(function(e){o(e)})}return a.promise()};e.browse={defaults:{dir:function(){return{files:[],dirs:[]}},root:"/",separator:"/",labels:true,change:e.noop,init:e.noop,item_class:e.noop,rename_delay:300,dbclick_delay:2e3,open:e.noop,rename:e.noop,copy:e.noop,upload:e.noop,name:"default",error:e.noop,refresh_timer:100},strings:{toolbar:{back:"back",up:"up",refresh:"refresh"}},escape_regex:function(e){if(typeof e=="string"){var t=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(t,"\\$1")}}};var n;var a;var i={};var s;function o(e){return function(t){return e==t}}function l(t,r){var n=e(r);return n.parents().add("html,body").map(function(){return e(this)[t]()}).get().reduce(function(e,t){return e+t})}function f(t,r){return t===r||r.match(new RegExp("^"+e.browse.escape_regex(t)))}e.fn.browse=function(t){var c=e.extend({},e.browse.defaults,t);function d(t){if(G){var r=A.offset();q=t.clientX-r.left;B=t.clientY-r.top;W.show();h();O=true;var n=F.find("li");if(!t.ctrlKey){n.removeClass("selected");i[c.name]=[]}var a=W[0].getBoundingClientRect();var s=n.filter(function(){var e=this.getBoundingClientRect();return e.top+e.height>a.top&&e.left+e.width>a.left&&e.bottom-e.height<a.bottom&&e.right-e.width<a.right});s.addClass("selected").each(function(){i[c.name].push(b.join(C,e(this).text()))})}}function u(e){G=false;W.hide();b.removeClass("no-select")}function h(e){var t=l("scrollTop",F);var r=Math.max(Math.min(Y,q),0);var n=Math.max(Math.min($,B),-t);var a=Math.max(Y,q);var i=Math.max($,B);var s=F.prop("clientWidth");var o=F.height()+F.scrollTop()-2;if(a>s){a=s}if(i>o){i=o}W.css({left:r,top:n+t,width:a-r,height:i-n})}function v(e){if(b.hasClass("selected")&&!_){var t;var r=F.find(".active");if(e.ctrlKey){if(e.which==67){b.copy()}else if(e.which==88){b.cut()}else if(e.which==86){b.paste(a)}}if(e.which==32){var e=jQuery.Event("click");e.ctrlKey=true;e.target=r[0];r.trigger(e);return false}else if(e.which==8){b.back()}else{if(e.which==13&&r.length){k=(new Date).getTime();r.dblclick()}else{if(e.which>=37&&e.which<=40){if(!e.ctrlKey){F.find("li").removeClass("selected")}if(!r.length){r=F.find("li:eq(0)").addClass("active")}else{var n=F.find("li");var i=F.prop("clientWidth");var s=n.length;var o=F.find("li:eq(0)").outerWidth(true);var l=Math.floor(i/o);t=r.index();if(e.which==37){t--}else if(e.which==38){t=t-l}else if(e.which==39){t++}else if(e.which==40){t=t+l}if(t<0){t=0}else if(t>s-1){t=s-1}n.eq(t).addClass("active").siblings().removeClass("active")}}}}}}function p(t){if(!e(t.target).closest("."+w).length){e(".browser-widget").removeClass("selected")}}function m(){e("."+w).each(function(){var t=e(this).browse();if(t.path()==C&&t.name()==c.name){t.refresh()}})}function g(){var t=e(this);var r=t.parent().find("span").text();var n=t.val();if(n!=r){c.rename(b.join(C,r),b.join(C,n));m()}}if(this.data("browse")){return this.data("browse")}else if(this.length>1){return this.each(function(){e.fn.browse.call(e(this),c)})}else{var w="browser-widget";i[c.name]=i[c.name]||[];var b=this;b.addClass(w+" hidden");var y=new r(b,c.upload,c.error);var C;var x=[];var T;var k;var _=false;var E=0;var j=e('<div class="toolbar"/>').appendTo(b);var D=e('<div class="adress-bar"></div>').appendTo(j);e("<button>Home</button>").addClass("home").appendTo(D);var K=e("<ul></ul>").appendTo(j);if(c.labels){K.addClass("labels")}var R=e("<input />").appendTo(D);var M=e.browse.strings.toolbar;Object.keys(M).forEach(function(t){e("<li/>").text(M[t]).addClass(t).appendTo(K)});var F=e("<ul/>").wrap("<div/>").parent().addClass("content").appendTo(b);var A=F.find("ul");var Y=0,$=0,q=0,B=0;var W=e("<div/>").addClass("selection").hide().appendTo(F);var G=false;var O=false;j.on("click.browse","li",function(){var t=e(this);if(!t.hasClass("disabled")){var r=t.text();b[r]()}}).on("click",".home",function(){if(C!=c.root){b.show(c.root)}}).on("keypress.browse","input",function(t){if(t.which==13){var r=e(this);var n=r.val();b.show(n)}});F.on("dblclick.browse","li",function(t){var r=e(this);var n=r.find("span").text();var a=b.join(C,n);var i=(new Date).getTime()-k;if(i<c.rename_delay&&i<c.dbclick_delay){if(r.hasClass("directory")){r.removeClass("selected");b.show(a)}else if(r.hasClass("file")){c.open(a)}}}).on("click.browse","li",function(t){if(!G){var r=e(t.target);var n=e(this);var a=n.find("span").text();var s=b.join(C,a);if(r.is("span")){if(E++%2===0){k=(new Date).getTime()}else{var l=(new Date).getTime()-k;if(l>c.rename_delay&&l<c.dbclick_delay){e("<textarea>"+a+"</textarea>").appendTo(n).focus().select();n.addClass("rename");_=true;return false}}}else{k=(new Date).getTime()}if(!t.ctrlKey){n.siblings().removeClass("selected")}if(!r.is("textarea")){F.find(".active").removeClass("active");n.toggleClass("selected").addClass("active");if(n.hasClass("selected")){if(!t.ctrlKey){i[c.name]=[]}i[c.name].push(s)}else if(t.ctrlKey){i[c.name]=i[c.name].filter(o(s))}else{i[c.name]=[]}}}}).on("keypress","textarea",function(t){if(t.which==13){g.call(this)}else if(t.which==27){var r=e(this);r.parent().removeClass("rename");r.remove()}if([13,27].indexOf(t.which)!=-1){_=false;return false}});b.on("click.browse",function(t){e("."+w).removeClass("selected");b.addClass("selected");var r=e(t.target);if(!O){if(!t.ctrlKey&&!r.is(".content li")&&!r.closest(".toolbar").length){F.find("li").removeClass("selected");i[c.name]=[]}}if(!r.is("textarea")){F.find("li.rename").removeClass("rename").find("textarea").each(g).remove();_=false}});b.on("dragover.browse",".content",function(e){if(e.originalEvent){e=e.originalEvent}e.dataTransfer.dropEffect="move";return false}).on("dragstart",".content li",function(t){t.originalEvent.dataTransfer.setData("text","anything");var r=e(this);var n=r.text();s={name:n,node:r,path:C,context:b};s.selection=r.hasClass("selected")});function Q(e){if(e.originalEvent){e=e.originalEvent}if(e.dataTransfer.items&&e.dataTransfer.items.length){return!![].filter.call(e.dataTransfer.items,function(e){return e.kind=="file"}).length}else{return e.dataTransfer.files&&e.dataTransfer.files.length}}F.on("drop.browse",function(t){var r=e(t.target);var n;if(r.is(".directory")){n=b.join(C,r.text())}else{n=C}if(Q(t)){y.process(t,n).then(function(){if(!r.is(".directory")){m()}})}else{if(b.name()!==s.context.name()){var a="You can't drag across different filesystems";throw new Error(a)}var o;if(s.selection){o=e.when.appy(e,i[c.name].map(function(e){var t=b.join(n,b.split(e).pop());if(!f(e,t)){return b._rename(e,t)}}))}else{var l=b.join(s.path,s.name);var d=b.join(n,s.name);o=b._rename(l,d)}o.then(function(){s.context.refresh();m()})}return false}).on("mousedown.browse",function(t){var r=e(t.target);if(!r.is("li")&&!r.is("span")){G=true;O=false;b.addClass("no-select");var n=A.offset();Y=t.clientX-n.left;$=t.clientY-n.top}});e(document).on("click",p).on("keydown",v).on("mousemove",d).on("mouseup",u);e.extend(b,{path:function(){return C},name:function(){return c.name},current:function(){return current},back:function(){if(x.length>1){x.pop();b.show(x[x.length-1],{push:false})}return b},destroy:function(){b.off(".browse");e(document).off("click",p).off("keydown",v);D.remove();F.remove()},_rename:function(t,r){if(!f(t,r)){return c.rename(t,r)}else{return e.when()}},_copy:function(t,r){if(!f(t,r)){return c.copy(t,r)}else{return e.when()}},copy:function(){n={path:C,contents:i[c.name],source:b};a=false},cut:function(){b.copy();a=true},paste:function(t){function r(t,r){return e.when.apply(e,n.contents.map(function(n){var a=t.split(n).pop();var i=t.join(C,a);if(!f(n,i)){return t[r](n,i)}else{return e.when()}}))}if(n&&n.contents&&n.contents.length){if(b.name()!==n.source.name()){throw new Error("You can't paste across different filesystems")}else{var a;if(t){a=r(b,"_rename")}else{a=r(b,"_copy")}a.then(function(){n.source.refresh();m()})}}},up:function(){var e=b.split(C);e.pop();b.show(b.join.apply(b,e));return b},refresh:function(){F.addClass("hidden");var t=e.Deferred();var r=e.Deferred();if(c.refresh_timer){setTimeout(t.resolve.bind(t),c.refresh_timer)}else{t.resolve()}b.show(C,{force:true,push:false,callback:function(){r.resolve()}});e.when(t,r).then(function(){F.removeClass("hidden")})},show:function(t,r){var n={callback:e.noop,push:true,force:false};r=e.extend({},n,r);if(C!=t||r.force){b.addClass("hidden");if(r.push){x.push(t)}j.find(".up").toggleClass("disabled",t==c.root);j.find(".back").toggleClass("disabled",x.length==1);C=t;var a=c.dir(C,s);if(a&&a.then){a.then(s)}var i=false;function s(n){if(i){return}i=true;if(!n){c.error("Invalid directory");b.removeClass("hidden")}else{T=n;A.empty();T.dirs.forEach(function(r){var n=c.item_class(t,r);var a=e('<li class="directory"><span>'+r+"</span></li>").appendTo(A).attr("draggable",true);if(n){a.addClass(n)}});T.files.forEach(function(r){var n=e('<li class="file"><span>'+r+"</span></li>").appendTo(A).attr("draggable",true);if(r.match(".")){n.addClass(r.split(".").pop())}var a=c.item_class(t,r);if(a){n.addClass(a)}});b.removeClass("hidden");R.val(t);c.change.call(b);r.callback()}}}return b},join:function(){var t=[].slice.call(arguments);var r=t.map(function(t){var r=new RegExp(e.browse.escape_regex(c.separator)+"$","");return t.replace(r,"")}).filter(Boolean).join(c.separator);var n=new RegExp("^"+e.browse.escape_regex(c.root));return n.test(r)?r:c.root+r},split:function(t){var r=new RegExp("^"+e.browse.escape_regex(c.root));var n=new RegExp(e.browse.escape_regex(c.separator)+"$");t=t.replace(r,"").replace(n,"");if(t){return t.split(c.separator)}else{return[]}},walk:function(e,t){var r=this.split(e);var n;while(r.length){n=t(r.shift(),!r.length)}return n}});setTimeout(function(){var e=c.start_directory||c.root;b.show(e,{callback:c.init.bind(b)})},0);b.data("browse",b);return b}}})(jQuery);