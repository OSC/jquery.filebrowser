/**@license
 *
 * jQuery Browse - directory browser jQuery plugin 0.1.0
 *
 * Copyright (c) 2016 Jakub Jankiewicz <http://jcubic.pl>
 * Released under the MIT license
 *
 * Date: Tue, 06 Dec 2016 20:55:43 +0000
 */
(function(e,r){e.browse={defaults:{dir:function(){return{files:[],dirs:[]}},root:"/",separator:"/",labels:true,on_change:e.noop,on_init:e.noop,refresh_timer:200},strings:{toolbar:{back:"back",up:"up",refresh:"refresh"}},escape_regex:function(e){if(typeof e=="string"){var r=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(r,"\\$1")}}};e.fn.browse=function(r){var a=e.extend({},e.browse.defaults,r);if(this.data("browse")){return this.data("browse")}else if(this.length>1){return this.each(function(){e.fn.browse.call(e(this),a)})}else{var s=this;s.addClass("browse hidden");var t;var n=[];var o;var i=e('<input class="adress-bar"/>').append;var l=e('<ul class="toolbar"></ul>').appendTo(s);if(a.labels){l.addClass("labels")}var c=e.browse.strings.toolbar;Object.keys(c).forEach(function(r){e("<li/>").text(c[r]).addClass(r).appendTo(l)});l.on("click","li",function(){var r=e(this);if(!r.hasClass("disabled")){var a=r.text();s[a]()}});var f=e("<ul/>").appendTo(s);f.on("dblclick","li",function(){var r=e(this);var n=s.join(t,r.text());if(r.hasClass("directory")){s.show(n)}else if(r.hasClass("file")){a.open(n)}});e.extend(s,{path:function(){return t},current:function(){return current},back:function(){n.pop();s.show(n[n.length-1],{push:false});return s},up:function(){var e=s.split(t);e.pop();s.show(s.join.apply(s,e));return s},refresh:function(){f.addClass("hidden");var r=e.Deferred();var n=e.Deferred();if(a.refresh_timer){setTimeout(r.resolve.bind(r),a.refresh_timer)}else{r.resolve()}s.show(t,{force:true,push:false,callback:function(){n.resolve()}});e.when(r,n).then(function(){f.removeClass("hidden")})},show:function(r,i){var c={callback:e.noop,push:true,force:false};i=e.extend({},c,i);if(t!=r||i.force){s.addClass("hidden");if(i.push){n.push(r)}l.find(".up").toggleClass("disabled",r==a.root);l.find(".back").toggleClass("disabled",n.length==1);t=r;a.dir(t,function(t){o=t;s.addClass("hidden");f.empty();o.dirs.forEach(function(s){var t=a.item_class(r,s);var n=e('<li class="directory">'+s+"</li>").appendTo(f);if(t){n.addClass(t)}});o.files.forEach(function(s){var t=e('<li class="file">'+s+"</li>").appendTo(f);if(s.match(".")){t.addClass(s.split(".").pop())}var n=a.item_class(r,s);if(n){t.addClass(n)}});s.removeClass("hidden");a.on_change.call(s);i.callback()})}return s},join:function(){var r=[].slice.call(arguments);var s=r.map(function(r){var s=new RegExp(e.browse.escape_regex(a.separator)+"$","");return r.replace(s,"")}).filter(Boolean).join(a.separator)+a.separator;var t=new RegExp("^"+e.browse.escape_regex(a.root));return t.test(s)?s:a.root+s},split:function(r){var s=new RegExp("^"+e.browse.escape_regex(a.root));r=r.replace(s,"");if(r){return r.split(a.separator).slice(0,-1)}else{return[]}},walk:function(e,r){var a=this.split(e);var s;while(a.length){s=r(a.shift(),e)}return s}});setTimeout(function(){var e=a.start_directory||a.root;s.show(e,{callback:a.on_init.bind(s)})},0);s.data("browse",s);return s}}})(jQuery);