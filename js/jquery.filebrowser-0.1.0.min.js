/**@license
 *
 * jQuery Browse - directory browser jQuery plugin 0.1.0
 *
 * Copyright (c) 2016 Jakub Jankiewicz <http://jcubic.pl>
 * Released under the MIT license
 *
 * Date: Thu, 08 Dec 2016 17:15:33 +0000
 */
(function(e,r){e.browse={defaults:{dir:function(){return{files:[],dirs:[]}},root:"/",separator:"/",labels:true,on_change:e.noop,on_init:e.noop,item_class:e.noop,refresh_timer:200},strings:{toolbar:{back:"back",up:"up",refresh:"refresh"}},escape_regex:function(e){if(typeof e=="string"){var r=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(r,"\\$1")}}};e.fn.browse=function(r){var s=e.extend({},e.browse.defaults,r);if(this.data("browse")){return this.data("browse")}else if(this.length>1){return this.each(function(){e.fn.browse.call(e(this),s)})}else{var a=this;a.addClass("browse hidden");var t;var n=[];var o;var i=e('<input class="adress-bar"/>').append;var l=e('<ul class="toolbar"></ul>').appendTo(a);if(s.labels){l.addClass("labels")}var c=e.browse.strings.toolbar;Object.keys(c).forEach(function(r){e("<li/>").text(c[r]).addClass(r).appendTo(l)});l.on("click","li",function(){var r=e(this);if(!r.hasClass("disabled")){var s=r.text();a[s]()}});var f=e("<ul/>").appendTo(a);f.on("dblclick","li",function(){var r=e(this);var n=a.join(t,r.text());if(r.hasClass("directory")){a.show(n)}else if(r.hasClass("file")){s.open(n)}});e.extend(a,{path:function(){return t},current:function(){return current},back:function(){n.pop();a.show(n[n.length-1],{push:false});return a},up:function(){var e=a.split(t);e.pop();a.show(a.join.apply(a,e));return a},refresh:function(){f.addClass("hidden");var r=e.Deferred();var n=e.Deferred();if(s.refresh_timer){setTimeout(r.resolve.bind(r),s.refresh_timer)}else{r.resolve()}a.show(t,{force:true,push:false,callback:function(){n.resolve()}});e.when(r,n).then(function(){f.removeClass("hidden")})},show:function(r,i){var c={callback:e.noop,push:true,force:false};i=e.extend({},c,i);if(t!=r||i.force){a.addClass("hidden");if(i.push){n.push(r)}l.find(".up").toggleClass("disabled",r==s.root);l.find(".back").toggleClass("disabled",n.length==1);t=r;s.dir(t,function(t){o=t;a.addClass("hidden");f.empty();o.dirs.forEach(function(a){var t=s.item_class(r,a);var n=e('<li class="directory">'+a+"</li>").appendTo(f);if(t){n.addClass(t)}});o.files.forEach(function(a){var t=e('<li class="file">'+a+"</li>").appendTo(f);if(a.match(".")){t.addClass(a.split(".").pop())}var n=s.item_class(r,a);if(n){t.addClass(n)}});a.removeClass("hidden");s.on_change.call(a);i.callback()})}return a},join:function(){var r=[].slice.call(arguments);var a=r.map(function(r){var a=new RegExp(e.browse.escape_regex(s.separator)+"$","");return r.replace(a,"")}).filter(Boolean).join(s.separator)+s.separator;var t=new RegExp("^"+e.browse.escape_regex(s.root));return t.test(a)?a:s.root+a},split:function(r){var a=new RegExp("^"+e.browse.escape_regex(s.root));r=r.replace(a,"");if(r){return r.split(s.separator).slice(0,-1)}else{return[]}},walk:function(e,r){var s=this.split(e);var a;while(s.length){a=r(s.shift(),e)}return a}});setTimeout(function(){var e=s.start_directory||s.root;a.show(e,{callback:s.on_init.bind(a)})},0);a.data("browse",a);return a}}})(jQuery);