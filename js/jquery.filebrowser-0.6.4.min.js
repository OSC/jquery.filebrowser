/**@license
 *
 * jQuery File Browser - directory browser jQuery plugin version 0.6.4
 *
 * Copyright (c) 2016 Jakub Jankiewicz <http://jcubic.pl>
 * Released under the MIT license
 *
 * Date: Thu, 22 Dec 2016 11:28:21 +0000
 */
(function(e,t){"use strict";e.browse={defaults:{dir:function(){return{files:[],dirs:[]}},root:"/",separator:"/",labels:true,change:e.noop,init:e.noop,item_class:e.noop,rename_delay:300,dbclick_delay:2e3,open:e.noop,rename:e.noop,copy:e.noop,name:"default",error:e.noop,refresh_timer:100},strings:{toolbar:{back:"back",up:"up",refresh:"refresh"}},escape_regex:function(e){if(typeof e=="string"){var t=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(t,"\\$1")}}};var a;var r;var n={};var i;function s(e){return function(t){return e==t}}function o(t,a){var r=e(a);return r.parents().add("html,body").map(function(){return e(this)[t]()}).get().reduce(function(e,t){return e+t})}function l(t,a){return t===a||a.match(new RegExp("^"+e.browse.escape_regex(t)))}e.fn.browse=function(t){var c=e.extend({},e.browse.defaults,t);function f(t){if(O){var a=D.offset();q=t.clientX-a.left;B=t.clientY-a.top;W.show();h();Q=true;var r=R.find("li");if(!t.ctrlKey){r.removeClass("selected");n[c.name]=[]}var i=W[0].getBoundingClientRect();var s=r.filter(function(){var e=this.getBoundingClientRect();return e.top+e.height>i.top&&e.left+e.width>i.left&&e.bottom-e.height<i.bottom&&e.right-e.width<i.right});s.addClass("selected").each(function(){n[c.name].push(g.join(b,e(this).text()))})}}function d(e){O=false;W.hide();g.removeClass("no-select")}function h(e){var t=o("scrollTop",R);var a=Math.max(Math.min(Y,q),0);var r=Math.max(Math.min($,B),-t);var n=Math.max(Y,q);var i=Math.max($,B);var s=R.prop("clientWidth");var l=R.height()+R.scrollTop()-2;if(n>s){n=s}if(i>l){i=l}W.css({left:a,top:r+t,width:n-a,height:i-r})}function u(e){if(g.hasClass("selected")&&!k){var t;var a=R.find(".active");if(e.ctrlKey){if(e.which==67){g.copy()}else if(e.which==88){g.cut()}else if(e.which==86){g.paste(r)}}if(e.which==32){var e=jQuery.Event("click");e.ctrlKey=true;e.target=a[0];a.trigger(e);return false}else if(e.which==8){g.back()}else{if(e.which==13&&a.length){a.dblclick()}else{if(e.which>=37&&e.which<=40){if(!e.ctrlKey){R.find("li").removeClass("selected")}if(!a.length){a=R.find("li:eq(0)").addClass("active")}else{var n=R.find("li");var i=R.prop("clientWidth");var s=n.length;var o=R.find("li:eq(0)").outerWidth(true);var l=Math.floor(i/o);t=a.index();if(e.which==37){t--}else if(e.which==38){t=t-l}else if(e.which==39){t++}else if(e.which==40){t=t+l}if(t<0){t=0}else if(t>s-1){t=s-1}n.eq(t).addClass("active").siblings().removeClass("active")}}}}}}function v(t){if(!e(t.target).closest("."+w).length){e(".browser-widget").removeClass("selected")}}function p(){e("."+w).each(function(){var t=e(this).browse();if(t.path()==b&&t.name()==c.name){t.refresh()}})}function m(){var t=e(this);var a=t.parent().find("span").text();var r=t.val();if(r!=a){c.rename(g.join(b,a),g.join(b,r));p()}}if(this.data("browse")){return this.data("browse")}else if(this.length>1){return this.each(function(){e.fn.browse.call(e(this),c)})}else{var w="browser-widget";n[c.name]=n[c.name]||[];var g=this;g.addClass(w+" hidden");var b;var C=[];var y;var x;var k=false;var _=0;var T=e('<div class="toolbar"/>').appendTo(g);var j=e('<div class="adress-bar"></div>').appendTo(T);e("<button>Home</button>").addClass("home").appendTo(j);var E=e("<ul></ul>").appendTo(T);if(c.labels){E.addClass("labels")}var K=e("<input />").appendTo(j);var M=e.browse.strings.toolbar;Object.keys(M).forEach(function(t){e("<li/>").text(M[t]).addClass(t).appendTo(E)});var R=e("<ul/>").wrap("<div/>").parent().addClass("content").appendTo(g);var D=R.find("ul");var Y=0,$=0,q=0,B=0;var W=e("<div/>").addClass("selection").hide().appendTo(R);var O=false;var Q=false;T.on("click.browse","li",function(){var t=e(this);if(!t.hasClass("disabled")){var a=t.text();g[a]()}}).on("click",".home",function(){if(b!=c.root){g.show(c.root)}}).on("keypress.browse","input",function(t){if(t.which==13){var a=e(this);var r=a.val();g.show(r)}});R.on("dblclick.browse","li",function(t){var a=e(this);var r=a.find("span").text();var n=g.join(b,r);var i=(new Date).getTime()-x;if(i<c.rename_delay&&i<c.dbclick_delay){if(a.hasClass("directory")){a.removeClass("selected");g.show(n)}else if(a.hasClass("file")){c.open(n)}}}).on("click.browse","li",function(t){if(!O){var a=e(t.target);var r=e(this);var i=r.find("span").text();var o=g.join(b,i);if(a.is("span")){if(_++%2===0){x=(new Date).getTime()}else{var l=(new Date).getTime()-x;if(l>c.rename_delay&&l<c.dbclick_delay){e("<textarea>"+i+"</textarea>").appendTo(r).focus().select();r.addClass("rename");k=true;return false}}}if(!t.ctrlKey){r.siblings().removeClass("selected")}if(!a.is("textarea")){R.find(".active").removeClass("active");r.toggleClass("selected").addClass("active");if(r.hasClass("selected")){if(!t.ctrlKey){n[c.name]=[]}n[c.name].push(o)}else if(t.ctrlKey){n[c.name]=n[c.name].filter(s(o))}else{n[c.name]=[]}}}}).on("keypress","textarea",function(t){if(t.which==13){m.call(this)}else if(t.which==27){var a=e(this);a.parent().removeClass("rename");a.remove()}if([13,27].indexOf(t.which)!=-1){k=false;return false}});g.on("click.browse",function(t){e("."+w).removeClass("selected");g.addClass("selected");var a=e(t.target);if(!Q){if(!t.ctrlKey&&!a.is(".content li")&&!a.closest(".toolbar").length){R.find("li").removeClass("selected");n[c.name]=[]}}if(!a.is("textarea")){R.find("li.rename").removeClass("rename").find("textarea").each(m).remove();k=false}});g.on("dragover.browse",".content",function(){return false}).on("dragstart",".content li",function(){var t=e(this);var a=t.text();i={name:a,path:b,context:g};if(t.hasClass("selected")){i.selection=true}});R.on("drop.browse",function(t){var a=e(t.target);if(g.name()!==i.context.name()){throw new Error("You can't drag across different filesystems")}var r;if(a.is(".directory")){r=g.join(b,a.text())}else{r=b}if(i.selection){n[c.name].forEach(function(e){var t=g.join(r,g.split(e).pop());if(!l(e,t)){g._rename(e,t)}});p()}else{var s=g.join(b,i.name);var o=g.join(i.path,i.name);if(!l(o,s)){g._rename(o,s);p()}}return false}).on("mousedown.browse",function(t){var a=e(t.target);if(!a.is("li")&&!a.is("span")){O=true;Q=false;g.addClass("no-select");var r=D.offset();Y=t.clientX-r.left;$=t.clientY-r.top}});e(document).on("click",v).on("keydown",u).on("mousemove",f).on("mouseup",d);e.extend(g,{path:function(){return b},name:function(){return c.name},current:function(){return current},back:function(){if(C.length>1){C.pop();g.show(C[C.length-1],{push:false})}return g},destroy:function(){g.off(".browse");e(document).off("click",v).off("keydown",u);j.remove();R.remove()},_rename:function(e,t){if(!l(e,t)){c.rename(e,t)}},_copy:function(e,t){c.copy(e,t)},copy:function(){a={path:b,contents:n[c.name],source:g};r=false},cut:function(){g.copy();r=true},paste:function(e){function t(e,t){a.contents.forEach(function(a){var r=e.split(a).pop();var n=e.join(b,r);if(!l(a,n)){e[t](a,n)}})}if(a&&a.contents&&a.contents.length){if(g.name()!==a.source.name()){throw new Error("You can't paste across different filesystems")}else{if(e){t(g,"_rename")}else{t(g,"_copy")}p()}}},up:function(){var e=g.split(b);e.pop();g.show(g.join.apply(g,e));return g},refresh:function(){R.addClass("hidden");var t=e.Deferred();var a=e.Deferred();if(c.refresh_timer){setTimeout(t.resolve.bind(t),c.refresh_timer)}else{t.resolve()}g.show(b,{force:true,push:false,callback:function(){a.resolve()}});e.when(t,a).then(function(){R.removeClass("hidden")})},show:function(t,a){var r={callback:e.noop,push:true,force:false};a=e.extend({},r,a);if(b!=t||a.force){g.addClass("hidden");if(a.push){C.push(t)}T.find(".up").toggleClass("disabled",t==c.root);T.find(".back").toggleClass("disabled",C.length==1);b=t;c.dir(b,function(r){if(!r){c.error("Invalid directory");g.removeClass("hidden")}else{y=r;D.empty();y.dirs.forEach(function(a){var r=c.item_class(t,a);var n=e('<li class="directory"><span>'+a+"</span></li>").appendTo(D).attr("draggable",true);if(r){n.addClass(r)}});y.files.forEach(function(a){var r=e('<li class="file"><span>'+a+"</span></li>").appendTo(D).attr("draggable",true);if(a.match(".")){r.addClass(a.split(".").pop())}var n=c.item_class(t,a);if(n){r.addClass(n)}});g.removeClass("hidden");K.val(t);c.change.call(g);a.callback()}})}return g},join:function(){var t=[].slice.call(arguments);var a=t.map(function(t){var a=new RegExp(e.browse.escape_regex(c.separator)+"$","");return t.replace(a,"")}).filter(Boolean).join(c.separator);var r=new RegExp("^"+e.browse.escape_regex(c.root));return r.test(a)?a:c.root+a},split:function(t){var a=new RegExp("^"+e.browse.escape_regex(c.root));var r=new RegExp(e.browse.escape_regex(c.separator)+"$");t=t.replace(a,"").replace(r,"");if(t){return t.split(c.separator)}else{return[]}},walk:function(e,t){var a=this.split(e);var r;while(a.length){r=t(a.shift(),!a.length)}return r}});setTimeout(function(){var e=c.start_directory||c.root;g.show(e,{callback:c.init.bind(g)})},0);g.data("browse",g);return g}}})(jQuery);